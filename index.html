<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle-Spiel mit Leaderboard und mehr Puzzle-Typen</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #game-container {
            margin-top: 20px;
            display: grid;
            gap: 2px;
        }
        .tile {
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: lightblue;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        #leaderboard {
            margin-top: 20px;
            border: 1px solid #000;
            padding: 10px;
            width: 300px;
        }
        #leaderboard ul {
            list-style: none;
            padding: 0;
        }
        #leaderboard li {
            display: flex;
            justify-content: space-between;
        }
        /* Styles für Sudoku und Match-3 */
        #sudoku-grid, #match3-grid {
            display: grid;
            gap: 2px;
        }
        #sudoku-grid .cell, #match3-grid .cell {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            border: 1px solid black;
        }
        .input-cell {
            background-color: #f0f0f0;
            cursor: text;
            text-align: center;
        }
        .match3-cell {
            width: 60px;
            height: 60px;
            background-color: lightcoral;
            font-size: 18px;
        }
        /* Start-Button und Namenseingabe */
        #start-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #start-button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Puzzle-Spiel</h1>
    <div id="start-menu">
        <input type="text" id="player-name" placeholder="Gib deinen Namen ein" />
        <button id="start-button">Spiel starten</button>
    </div>
    <div id="game-container" style="display: none;"></div>
    <div id="timer">Zeit: <span id="time">0</span> Sekunden</div>
    <div id="score">Punkte: <span id="points">0</span></div>

    <h2>Leaderboard</h2>
    <div id="leaderboard">
        <ul id="leaderboard-list"></ul>
    </div>
    
    <script>
        let gridSize = 3;  // Startgröße des Schiebe-Puzzles (3x3)
        let level = 1;      // Level des Spiels
        let puzzleTypes = ['sliding', 'sudoku', 'match3']; // Puzzle-Typen
        let points = 0;
        let timer;
        let timeTaken = 0;
        let currentPuzzle = '';

        // Startet das Spiel
        document.getElementById('start-button').addEventListener('click', function() {
            const playerName = document.getElementById('player-name').value.trim();
            if (playerName === '') {
                alert('Bitte gib deinen Namen ein.');
                return;
            }
            startGame(playerName);
        });

        function loadLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '';
            leaderboard.forEach((entry) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${entry.name}</span><span>${entry.score}</span>`;
                leaderboardList.appendChild(li);
            });
        }

        function saveToLeaderboard(name, score) {
            let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
            leaderboard.push({ name, score });
            leaderboard.sort((a, b) => b.score - a.score); // Sortieren nach Punkten
            leaderboard = leaderboard.slice(0, 5); // Nur die Top 5 speichern
            localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
            loadLeaderboard();
        }

        function startGame(playerName) {
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            points = 0;  // Punkte zurücksetzen
            level = 1;   // Level zurücksetzen
            startNewLevel(playerName);
        }

        function startNewLevel(playerName) {
            timeTaken = 0;
            document.getElementById('time').textContent = timeTaken;
            timer = setInterval(() => {
                timeTaken++;
                document.getElementById('time').textContent = timeTaken;
            }, 1000);

            // Alle 10 Level schwieriger machen
            if (level % 10 === 0) {
                gridSize++;
            }

            generatePuzzle();
            level++;
        }

        function generatePuzzle() {
            currentPuzzle = puzzleTypes[Math.floor(Math.random() * puzzleTypes.length)]; // Zufällig Puzzle-Typ auswählen
            const container = document.getElementById('game-container');
            container.innerHTML = '';

            if (currentPuzzle === 'sliding') {
                generateSlidingPuzzle(gridSize);
            } else if (currentPuzzle === 'sudoku') {
                generateSudokuPuzzle();
            } else if (currentPuzzle === 'match3') {
                generateMatch3Puzzle();
            }
        }

        /** Schiebe-Puzzle **/
        function generateSlidingPuzzle(size) {
            let grid = [];
            let numbers = [];
            for (let i = 0; i < size * size - 1; i++) {
                numbers.push(i + 1);
            }
            numbers.push(null);  // Das letzte Feld ist leer
            numbers.sort(() => Math.random() - 0.5);  // Mische das Array

            for (let i = 0; i < size; i++) {
                grid.push(numbers.slice(i * size, i * size + size));
            }
            renderSlidingGrid(grid);
        }

        function renderSlidingGrid(grid) {
            const container = document.getElementById('game-container');
            container.style.gridTemplateColumns = `repeat(${grid.length}, 100px)`;
            container.style.gridTemplateRows = `repeat(${grid.length}, 100px)`;
            container.innerHTML = ''; // Leeren des Containers für das neue Grid
            grid.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const tile = document.createElement('div');
                    tile.classList.add('tile');
                    if (cell !== null) {
                        tile.textContent = cell;
                        tile.addEventListener('click', () => moveTile(rowIndex, colIndex, grid));
                    } else {
                        tile.style.backgroundColor = 'white';
                    }
                    container.appendChild(tile);
                });
            });
        }

        function moveTile(row, col, grid) {
            const emptyTile = findEmptyTile(grid);
            const [emptyRow, emptyCol] = emptyTile;
            const isAdjacent = (Math.abs(row - emptyRow) + Math.abs(col - emptyCol)) === 1;
            if (isAdjacent) {
                grid[emptyRow][emptyCol] = grid[row][col];
                grid[row][col] = null;
                renderSlidingGrid(grid);
                checkWin(grid);
            }
        }

        function findEmptyTile(grid) {
            for (let row = 0; row < grid.length; row++) {
                for (let col = 0; col < grid[row].length; col++) {
                    if (grid[row][col] === null) return [row, col];
                }
            }
        }

        function checkWin(grid) {
            let won = true;
            let counter = 1;
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    if (row === gridSize - 1 && col === gridSize - 1) continue;
                    if (grid[row][col] !== counter++) {
                        won = false;
                        break;
                    }
                }
            }
            if (won) {
                clearInterval(timer);
                const playerName = prompt("Du hast gewonnen! Gib deinen Namen für das Leaderboard ein:");
                saveToLeaderboard(playerName, points);
                points += Math.max(100 - timeTaken, 0); // Punkte basierend auf der Zeit hinzufügen
                startNewLevel(playerName); // Nächste Runde starten
            }
        }

        /** Sudoku Puzzle **/
        function generateSudokuPuzzle() {
            const container = document.getElementById('game-container');
            const sudokuGrid = document.createElement('div');
            sudokuGrid.id = 'sudoku-grid';
            sudokuGrid.style.gridTemplateColumns = 'repeat(9, 50px)';
            sudokuGrid.style.gridTemplateRows = 'repeat(9, 50px)';
            container.appendChild(sudokuGrid);

            // Beispiel-Sudoku (feste Lösung)
            const sudokuExample = [
                [5, 3, null, null, 7, null, null, null, null],
                [6, null, null, 1, 9, 5, null, null, null],
                [null, 9, 8, null, null, null, null, 6, null],
                [8, null, null, null, 6, null, null, null, 3],
                [4, null, null, 8, null, 3, null, null, 1],
                [7, null, null, null, 2, null, null, null, 6],
                [null, 6, null, null, null, null, 2, 8, null],
                [null, null, null, 4, 1, 9, null, null, 5],
                [null, null, null, null, 8, null, null, 7, 9]
            ];

            sudokuExample.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const cellElement = document.createElement('div');
                    cellElement.classList.add('cell');
                    if (cell === null) {
                        const input = document.createElement('input');
                        input.classList.add('input-cell');
                        input.type = 'text';
                        input.maxLength = 1;
                        cellElement.appendChild(input);
                    } else {
                        cellElement.textContent = cell;
                    }
                    sudokuGrid.appendChild(cellElement);
                });
            });

            // Überprüfe die Gewinnbedingungen
            const checkSudokuWin = () => {
                const inputs = document.querySelectorAll('.input-cell');
                let completed = true;
                let solution = [];
                inputs.forEach(input => {
                    if (input.value === '') {
                        completed = false;
                    } else {
                        solution.push(parseInt(input.value));
                    }
                });
                if (completed) {
                    // Einfache Gewinnlogik: Überprüfe nur, ob die Eingaben 1-9 enthalten
                    const isCorrect = solution.length === 81 && new Set(solution).size === 9;
                    if (isCorrect) {
                        clearInterval(timer);
                        const playerName = prompt("Du hast gewonnen! Gib deinen Namen für das Leaderboard ein:");
                        saveToLeaderboard(playerName, points);
                        points += Math.max(100 - timeTaken, 0); // Punkte basierend auf der Zeit hinzufügen
                        startNewLevel(playerName); // Nächste Runde starten
                    } else {
                        alert("Das Sudoku ist nicht korrekt!");
                    }
                } else {
                    alert("Bitte vervollständige das Sudoku!");
                }
            };

            // Button für die Gewinnüberprüfung
            const winButton = document.createElement('button');
            winButton.textContent = 'Überprüfen';
            winButton.addEventListener('click', checkSudokuWin);
            container.appendChild(winButton);
        }

        /** Match-3 Puzzle **/
        function generateMatch3Puzzle() {
            const container = document.getElementById('game-container');
            const match3Grid = document.createElement('div');
            match3Grid.id = 'match3-grid';
            match3Grid.style.gridTemplateColumns = `repeat(${gridSize}, 60px)`;
            match3Grid.style.gridTemplateRows = `repeat(${gridSize}, 60px)`;
            container.appendChild(match3Grid);

            const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
            let grid = [];

            // Generiere ein zufälliges Grid für Match-3
            for (let row = 0; row < gridSize; row++) {
                let gridRow = [];
                for (let col = 0; col < gridSize; col++) {
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const cell = document.createElement('div');
                    cell.classList.add('match3-cell');
                    cell.style.backgroundColor = color;
                    match3Grid.appendChild(cell);
                    gridRow.push(color);
                }
                grid.push(gridRow);
            }

            // Logik für das Erkennen von Matches
            const checkForMatches = () => {
                // Überprüfe horizontale und vertikale Matches
                for (let row = 0; row < gridSize; row++) {
                    for (let col = 0; col < gridSize - 2; col++) {
                        if (grid[row][col] === grid[row][col + 1] && grid[row][col] === grid[row][col + 2]) {
                            // Wenn ein Match gefunden wird, setze die Punkte
                            points += 10;
                            document.getElementById('points').textContent = points;
                            // Zerstöre die Kacheln
                            grid[row][col] = grid[row][col + 1] = grid[row][col + 2] = null;
                        }
                    }
                }
                // Vertikale Überprüfung
                for (let col = 0; col < gridSize; col++) {
                    for (let row = 0; row < gridSize - 2; row++) {
                        if (grid[row][col] === grid[row + 1][col] && grid[row][col] === grid[row + 2][col]) {
                            points += 10;
                            document.getElementById('points').textContent = points;
                            grid[row][col] = grid[row + 1][col] = grid[row + 2][col] = null;
                        }
                    }
                }
            };

            // Überprüfe Matches, wenn der Spieler klickt
            match3Grid.addEventListener('click', () => {
                checkForMatches();
                renderMatch3Grid(grid);
            });
        }

        function renderMatch3Grid(grid) {
            const match3Grid = document.getElementById('match3-grid');
            match3Grid.innerHTML = ''; // Lösche vorherige Zellen
            grid.forEach(row => {
                row.forEach(cellColor => {
                    const cell = document.createElement('div');
                    cell.classList.add('match3-cell');
                    cell.style.backgroundColor = cellColor || 'white'; // Setze Farbe oder leere Zelle
                    match3Grid.appendChild(cell);
                });
            });
        }

        loadLeaderboard();
    </script>
</body>
</html>
